<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corne de Brume et Bips</title>
    <script type="module">
        import { database, ref, onValue } from './firebaseConfig.js';

        let audioContext = null;
        let mainAudioPlaying = false;

        function startMainAudio() {
            if (!mainAudioPlaying) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const mainGainNode = audioContext.createGain();
                const mainOscillator = audioContext.createOscillator();
                mainOscillator.type = 'sine';
                mainOscillator.frequency.setValueAtTime(250, audioContext.currentTime);
                mainGainNode.gain.setValueAtTime(1, audioContext.currentTime);
                mainOscillator.connect(mainGainNode);
                mainGainNode.connect(audioContext.destination);
                mainOscillator.start();
                mainOscillator.stop(audioContext.currentTime + 10);

                mainOscillator.onended = () => {
                    mainAudioPlaying = false;
                };

                mainAudioPlaying = true;
            }
        }

        function stopMainAudio() {
            if (audioContext && mainAudioPlaying) {
                audioContext.close();
                mainAudioPlaying = false;
            }
        }

        function playAudio(fileName) {
            const audio = new Audio(fileName);
            audio.play();
        }

        function stopAudio(audio) {
            audio.pause();
            audio.currentTime = 0;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const commandRef = ref(database, 'commands/');
            onValue(commandRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const command = data.action;
                    if (command === 'play-main') {
                        startMainAudio();
                    } else if (command === 'stop-main') {
                        stopMainAudio();
                    } else if (command === 'play-audio1') {
                        playAudio('audio1.mp3');
                    } else if (command === 'stop-audio1') {
                        stopAudio('audio1.mp3');
                    } else if (command === 'play-audio2') {
                        playAudio('audio2.mp3');
                    } else if (command === 'stop-audio2') {
                        stopAudio('audio2.mp3');
                    }
                    // Réinitialiser la commande après l'exécution
                    set(commandRef, null);
                }
            });
        });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background-color: #f0f0f0;
        }
        h1 {
            color: #333;
        }
        #now-playing {
            margin-top: 30px;
            font-size: 20px;
            color: #666;
        }
        #allow-audio {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Corne de Brume et Bips Longs</h1>
    <div id="now-playing">Son en cours...</div>
    <button id="allow-audio">Autoriser l'audio</button>
</body>
</html>
